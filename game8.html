<!DOCTYPE html>
<html>
	<head>
		<meta charset='utf-8'>
		<title>Juegos con canvas</title>
		<script type="application/javascript" src='game8.js'></script>
		<link rel="stylesheet" type="text/css" href="style/style.css">
		<link rel="stylesheet" href="styles/pojoaque.css">	
		<script src="highlight.pack.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
	</head>
	<body>
		<p>
			Vamos a hacer que nuestra serpiente aumente de tamaño cada vez que como una manzana.<br>
			Para ello vamos a modificar un poco nuestro código anterior: como nuestra serpiente va a ser una serie de imágenes iguales vamos a declararla como un array, al cual vamos a ir añadiendole un elemento cada vez que comamos una manzana.
		</p>
		<pre>
			<code>
				//var player=new Rectangle(40,40,10,10);
				var body=new Array();
			</code>
		</pre>
		<p>
			Ahora, para que movamos nuestra serpiente, hay que sustituir player por body[0]. Donde body[0] es el priimer elemento de nuestro array, es decir: la cabeza de la serpiente.
		</p>
		<pre>
			<code>
function act(){
    if(!pause){
       if(lastPress==KEY_UP)
             body[0].y-=10;
        if(lastPress==KEY_RIGHT)
            body[0].x+=10;
        if(lastPress==KEY_DOWN)
             body[0].y+=10;
        if(lastPress==KEY_LEFT)
            body[0].x-=10;
        if(body[0].x>canvas.width-10)
            body[0].x=0;
        if(body[0].y>canvas.height-10)
            body[0].y=0;
        if(body[0].x<0)
            body[0].x=canvas.width-10;
        if(body[0].y<0)
            body[0].y=canvas.height-10;
			</code>
		</pre>
		<p>
			Ahora debemos recorrer nuestro array en la función paint para dibujar tantas imagenes como elemento haya en nuestro array.
		</p>
		<pre>
			<code>
	for(var i=0;i&lt;body.length;i++){
        ctx.drawImage(pared,wall[i].x,wall[i].y);
    }
			</code>
		</pre>
		<p>
			Para mover el cuerpo vamos a hacer que se mueva de atrás hacia adelante, es decir: vamos a coger el último elemento de nuestra serpiente y vamos a hacer que coja la posición del elemento anterior a él en el array. De esta forma con las flechas vamos moviendo la cabeza y elresto del cuerpo la va a seguir.
		</p>
		<pre>
			<code>
				for(var i=body.length-1;i>0;i--){
            body[i].x=body[i-1].x;
            body[i].y=body[i-1].y;
        }
			</code>
		</pre>
		<p>
			Siguiente paso:vamos a hacer que cuando comamos la manzana nuestra serpiente aumente, para ello añadiremos un elemento de tipo rectangle a nuestro array
		</p>
		<pre>
			<code>
				 body.push(new Rectangle(food.x,food.y,10,10));
			</code>
		</pre>
		
		<p>
			Podemos declarar también una variable score para guardar la puntuación y que esta vaya aumentando cada vez que comamos la manzana.
		</p>
		<pre>
			<code>
				var score=0;
			</code>
		</pre>
		<p>
			Con lo que el código al chocar con la manzana sería el siguiente:
		</p>
		<pre>
			<code>
			if(body[0].intersects(food)){
                body.push(new Rectangle(food.x,food.y,10,10));
                food.x=random(canvas.width/10-1)*10;
                food.y=random(canvas.height/10-1)*10;
                score++;
            }
			</code>
		</pre>
		<p>
			Y pintaremos en el extremo de nuestro canvas la palabra score seguido de la puntuación que tenemos.
		</p>
		<p>
			No podemos olvidarnos de controlar que nuestra serpiente cuando sea muy grande, si choca consigo mismo perdamos.
		</p>
		<pre>
			<code>
		 for(var i=4,l=body.length;i<l;i++){
            if(body[0].intersects(body[i])){
                pause=true;
            }
        }
			</code>
		</pre>
		<p>Por último vamos a controlar cuando perdemos: es decir, cuando nos choquemos o bien con el muro o bien con nosotros mismos habremos perdido la partida por lo que empezaremos declarando una variable booleana para saber si hemos perdido o no.</p>		
		<pre>
			<code>
				var gameover=false.
			</code>
		</pre>
		<p>
			Esta variable tomará el valor true cuando choque con la pared
		</p>
		<pre>
			<code>
			if(body[0].intersects(wall[i])){
                gameover=true;
                pause=true;
            }
			</code>
		</pre>
		<p>
			O cuando choquemos con nosotros mismo:
		</p>
		<pre>
			<code>
			for(var i=4,l=body.length;i<l;i++){
            if(body[0].intersects(body[i])){
                pause=true;
                gameover=true;
            }
        }
			</code>
		</pre>
		<p>Como es lógico si perdemos debemos reiniciar nuestro juego: es decir, nuestra puntación y el tamaño de nuestra serpiente: Para ello vamos a declarar una función reset()</p>
		<pre>
			<code>
function reset(){
    score=0;
    
    body[0].x=40;
    body[0].y=40;
    food.x=random(canvas.width/10-1)*10;
    food.y=random(canvas.height/10-1)*10;
    gameover=false;
}
			</code>
		</pre>
		<canvas id='canvas' width='300px' height='150px'>
			Canvas not supported by your browser
		</canvas>
	
	</body>
</html>